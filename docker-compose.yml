version: "3.9"

services:
  # MongoDB local instance
  mongo:
    image: mongo:7
    container_name: zack-mongo
    restart: unless-stopped
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    environment:
      MONGO_INITDB_DATABASE: zack
    networks:
      - zack-network

  # Go API
  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile.local
    container_name: zack-api
    restart: unless-stopped
    depends_on:
      - mongo
    environment:
      PORT: 8080
      ENV: development
      ALLOWED_ORIGIN: http://localhost:5173
      MONGODB_URI: mongodb://mongo:27017/zack
      MONGODB_DATABASE: zack
      # You'll need to set these in a .env file or pass them manually
      AUTH_TOTP_SECRET: ${AUTH_TOTP_SECRET:-changeme}
      AUTH_JWT_SECRET: ${AUTH_JWT_SECRET:-changeme-at-least-32-characters-long}
      OWNER_USER_ID: ${OWNER_USER_ID:-changeme}
    ports:
      - "8080:8080"
    networks:
      - zack-network

  # Optional: Web app (can run locally via pnpm instead)
  # Uncomment if you want to containerize the frontend too
  # web:
  #   build:
  #     context: .
  #     dockerfile: apps/web/Dockerfile
  #   container_name: zack-web
  #   restart: unless-stopped
  #   depends_on:
  #     - api
  #   environment:
  #     VITE_API_URL: http://localhost:8080
  #   ports:
  #     - "5173:5173"
  #   volumes:
  #     - ./apps/web:/app/apps/web
  #     - /app/node_modules
  #   networks:
  #     - zack-network

volumes:
  mongo_data:
    driver: local

networks:
  zack-network:
    driver: bridge
